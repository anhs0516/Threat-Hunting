
# Threat Hunting Case: KVM μ¤μ„μΉλ¥Ό μ΄μ©ν• λ§λ¶„λ¦¬ μ°ν κ°€λ¥μ„± νƒμƒ‰ π”

## 1\. Hunting κ°€μ„¤ (Hypothesis)

κΈμµκ¶μ€ λ‚΄λ¶€ μ •λ³΄ λ³΄νΈλ¥Ό μ„ν•΄ μ—…λ¬΄λ§κ³Ό μΈν„°λ„·λ§μ„ λ¶„λ¦¬ν•λ” **λ§λ¶„λ¦¬** μ •μ±…μ„ ν•„μμ μΌλ΅ μ μ©ν•©λ‹λ‹¤. κ·Έλ¬λ‚ μΌλ¶€ ν™κ²½μ—μ„λ” μ—…λ¬΄ ν¨μ¨μ„ μ΄μ λ΅ **KVM μ¤μ„μΉ**λ¥Ό μ‚¬μ©ν•΄ ν•λ‚μ PCμ—μ„ λ‘ λ§μ λ¨λ‹ν„°, ν‚¤λ³΄λ“, λ§μ°μ¤λ¥Ό κ³µμ ν•λ” κ²½μ°κ°€ μμµλ‹λ‹¤.

λ³Έ μΌ€μ΄μ¤λ” μ΄λ¬ν• ν™κ²½μ μ·¨μ•½μ μ„ μ•…μ©ν•΄ κ³µκ²©μκ°€ **μ—…λ¬΄λ§μ—μ„ νλ“ν• κΈ°λ°€ μ •λ³΄λ¥Ό μΈν„°λ„·λ§μΌλ΅ μ μ¶**ν•  μ μλ‹¤λ” κ°€μ„¤μ„ κΈ°λ°μΌλ΅ ν•©λ‹λ‹¤.

**κ°€μ„¤:**
KVM μ¤μ„μΉ νΌμ© ν™κ²½μ λ‹¨λ§μ—μ„ **`λ€λ‰μ ν΄λ¦½λ³΄λ“ λ³µμ‚¬`** λ° **`λΉ„μ •μƒμ μΈ μ™Έλ¶€ νμΌ μ „μ†΅`** μ΄ **λ™μΌ μ‹κ°„λ€**μ— λ°μƒν•λ‹¤λ©΄, λ‚΄λ¶€ μ •λ³΄ μ μ¶ μ‹λ„λ΅ κ°„μ£Όν•  μ μλ‹¤.

-----

## 2\. λ°μ΄ν„° μ†μ¤

| λ°μ΄ν„° μ†μ¤ | μ—­ν•  |
| :--- | :--- |
| **DLP λ΅κ·Έ** | μ—…λ¬΄λ§μ—μ„ λ°μƒν• \*\*λ―Όκ° μ •λ³΄ λ³µμ‚¬ ν–‰μ„(ν΄λ¦½λ³΄λ“, νμΌ)\*\*λ¥Ό νƒμ§€ν•©λ‹λ‹¤. |
| **Proxy/Firewall λ΅κ·Έ** | μΈν„°λ„·λ§μΌλ΅μ **λ°μ΄ν„° μ—…λ΅λ“ ν–‰μ„**λ¥Ό λ¶„μ„ν•μ—¬ λΉ„μΈκ°€ μ„λΉ„μ¤ μ΄μ© μ—¬λ¶€λ¥Ό ν™•μΈν•©λ‹λ‹¤. |
| **USB/Endpoint λ΅κ·Έ** | KVM μ¤μ„μΉ μ—°κ²° λλ” μ™Έλ¶€ μ €μ¥μ¥μΉ μ‚¬μ© λ“± **μ™Έλ¶€ μ¥μΉμ™€μ λ¬Όλ¦¬μ  μ—°κ²° μ •λ³΄**λ¥Ό ν™•μΈν•©λ‹λ‹¤. |
| **EDR λ΅κ·Έ** | λΉ„μ •μƒμ μΈ **ν”„λ΅μ„Έμ¤ μ‹¤ν–‰**μ„ νƒμ§€ν•΄ λ°μ΄ν„°μ μ„μ‹ μ €μ¥ λ° μ΅°μ‘ ν”μ μ„ μ¶”μ ν•©λ‹λ‹¤. |

-----


## 3\. Hunting μ μ°¨ λ° νƒμ§€ μ‹λ‚λ¦¬μ¤

#### (1) 1λ‹¨κ³„: ν–‰μ„ κΈ°λ° μ΄μƒ μ§•ν›„ νƒμƒ‰

**λ©μ :** μ—…λ¬΄λ§μ—μ„ ν‰μ†μ™€ λ‹¤λ¥Έ λ€λ‰μ ν΄λ¦½λ³΄λ“ λ³µμ‚¬ λλ” νμΌ λ³µμ‚¬ ν–‰μ„λ¥Ό ν™•μΈν•©λ‹λ‹¤.

```splunk
index=dlp_logs action="clipboard_copy" OR action="file_copy"
| stats count by user, host, _time
| where count > 100
| sort -count
```

> **μ„¤λ…:** ν‰μ† λ€λΉ„ κ³Όλ„ν•κ² λ§μ€ ν΄λ¦½λ³΄λ“ λ³µμ‚¬κ°€ λ°μƒν• μ‚¬μ©μλ¥Ό μ‹λ³„ν•©λ‹λ‹¤.

#### (2) 2λ‹¨κ³„: μ™Έλ¶€ μ „μ†΅ ν”μ  μ—°κ΄€ λ¶„μ„

**λ©μ :** 1λ‹¨κ³„μ—μ„ μ‹λ³„λ μ‚¬μ©μκ°€ μΈν„°λ„·λ§μ—μ„ μ™Έλ¶€ νμΌ μ—…λ΅λ“ μ„λΉ„μ¤λ¥Ό μ΄μ©ν–λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

```spl
index=proxy_logs method=POST OR method=PUT
| stats sum(bytes_out) as outbound_bytes by src_ip, dest_domain
| where outbound_bytes > 5000000 AND dest_domain IN ("drive.google.com", "dropbox.com", "*cloud.com", "github.com")
| join type=inner src_ip
    [search index=dlp_logs action="clipboard_copy" | stats count by host]
```

> **μ„¤λ…:** λ€λ‰μ λ°μ΄ν„°λ¥Ό μ™Έλ¶€ ν΄λΌμ°λ“ μ„λΉ„μ¤λ΅ μ „μ†΅ν• IPλ¥Ό μ°Ύκ³ , ν•΄λ‹Ή IPκ°€ μ—…λ¬΄λ§μ—μ„ ν΄λ¦½λ³΄λ“ λ³µμ‚¬ μ΄λ ¥μ΄ μλ” PCμΈμ§€ **μƒκ΄€κ΄€κ³„λ¥Ό λ¶„μ„**ν•©λ‹λ‹¤.

#### (3) 3λ‹¨κ³„: μ‹κ°„μ  μ—°κ΄€μ„± λ° KVM μ‚¬μ© ν”μ  ν™•μΈ

**λ©μ :** λ‘ μ΄λ²¤νΈκ°€ **λ™μΌν• μ‹κ°„λ€**μ— λ°μƒν–λ”μ§€ ν™•μΈν•κ³ , ν•΄λ‹Ή PCμ **KVM μ¤μ„μΉ μ‚¬μ© μ΄λ ¥**μ„ μ κ²€ν•©λ‹λ‹¤.

> **λ¶„μ„:** DLP λ΅κ·Έμ λ³µμ‚¬ λ°μƒ μ‹κ°„κ³Ό Proxy λ΅κ·Έμ μ „μ†΅ λ°μƒ μ‹κ°„μ„ λΉ„κµν•΄ **νƒ€μ„λΌμΈ**μ„ μΌμΉμ‹ν‚µλ‹λ‹¤. μ΄ν›„ EDR/USB λ΅κ·Έλ¥Ό ν†µν•΄ KVM μ¤μ„μΉ μ—°κ²° μ΄λ ¥μ„ ν™•μΈν•μ—¬ μ μ¶ μ‹λ„λ¥Ό ν™•μ •ν•©λ‹λ‹¤.

-----

## 4\. λ¶„μ„ κ²°κ³Ό λ° λ€μ‘ λ°©μ•

### **λ¶„μ„ κ²°κ³Ό**

νΉμ • μ‚¬μ©μ **`Kim`** μ μ—…λ¬΄λ§ PCμ—μ„ 10λ¶„ λ™μ• **500ν μ΄μƒμ ν΄λ¦½λ³΄λ“ λ³µμ‚¬** μ΄λ²¤νΈκ°€ λ°μƒν–μµλ‹λ‹¤. μ΄ν›„, λ™μΌ μ‚¬μ©μμ μΈν„°λ„·λ§ PCμ—μ„ **`Google Drive`** λ΅ **50MB** μ΄μƒμ νμΌ μ—…λ΅λ“κ°€ νƒμ§€λμ—μµλ‹λ‹¤. λ‘ μ΄λ²¤νΈμ λ°μƒ μ‹κ°„μ€ **1λ¶„ μ΄λ‚΄**λ΅ λ§¤μ° κ·Όμ ‘ν–μµλ‹λ‹¤. μ¶”κ°€ λ¶„μ„ κ²°κ³Ό, ν•΄λ‹Ή PCμ—λ” **KVM μ¤μ„μΉ**κ°€ μ—°κ²°λμ–΄ μμ—μµλ‹λ‹¤.

**κ²°λ΅ :** KVM μ¤μ„μΉλ¥Ό μ΄μ©ν• **λ‚΄λ¶€ μ •λ³΄ μ μ¶ μ‹λ„**λ΅ νλ‹¨.

### **λ€μ‘ λ°©μ•**

  * **μ¦‰κ°μ  μ΅°μΉ:** ν•΄λ‹Ή μ‚¬μ©μ κ³„μ • λ° PCμ— λ€ν• λ„¤νΈμ›ν¬ μ ‘κ·Όμ„ μ°¨λ‹¨ν•κ³ , ν¬λ μ‹ μ΅°μ‚¬λ¥Ό μ§„ν–‰ν•©λ‹λ‹¤.
  * **μ •μ±…μ  λ³΄μ™„:** KVM μ¤μ„μΉ μ‚¬μ©μ— λ€ν• **λ³΄μ• κ°€μ΄λ“λΌμΈμ„ κ°•ν™”**ν•κ³ , ν•„μ”μ‹ λ¬Όλ¦¬λ§ μ‚¬μ© κΈμ§€ μ •μ±…μ„ κ²€ν† ν•©λ‹λ‹¤.
  * **κΈ°μ μ  λ€μ‘:** DLP μ •μ±…μ— KVM μ¤μ„μΉλ¥Ό ν†µν• **ν΄λ¦½λ³΄λ“/νμΌ λ³µμ‚¬ μ°¨λ‹¨ λ£°**μ„ μ¶”κ°€ν•κ³ , Proxy λ£°μ„ κ°•ν™”ν•μ—¬ λΉ„μΈκ°€ ν΄λΌμ°λ“ μ„λΉ„μ¤λ΅μ νμΌ μ—…λ΅λ“λ¥Ό μ›μ² μ°¨λ‹¨ν•©λ‹λ‹¤.


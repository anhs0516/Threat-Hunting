
# Threat Hunting Case: KVM 스위치를 이용한 망분리 우회 가능성 탐색 🔍

## 1\. Hunting 가설 (Hypothesis)

금융권은 내부 정보 보호를 위해 업무망과 인터넷망을 분리하는 **망분리** 정책을 필수적으로 적용합니다. 그러나 일부 환경에서는 업무 효율을 이유로 **KVM 스위치**를 사용해 하나의 PC에서 두 망의 모니터, 키보드, 마우스를 공유하는 경우가 있습니다.

본 케이스는 이러한 환경의 취약점을 악용해 공격자가 **업무망에서 획득한 기밀 정보를 인터넷망으로 유출**할 수 있다는 가설을 기반으로 합니다.

**가설:**
KVM 스위치 혼용 환경의 단말에서 **`대량의 클립보드 복사`** 및 **`비정상적인 외부 파일 전송`** 이 **동일 시간대**에 발생한다면, 내부 정보 유출 시도로 간주할 수 있다.

-----

## 2\. 데이터 소스

| 데이터 소스 | 역할 |
| :--- | :--- |
| **DLP 로그** | 업무망에서 발생한 \*\*민감 정보 복사 행위(클립보드, 파일)\*\*를 탐지합니다. |
| **Proxy/Firewall 로그** | 인터넷망으로의 **데이터 업로드 행위**를 분석하여 비인가 서비스 이용 여부를 확인합니다. |
| **USB/Endpoint 로그** | KVM 스위치 연결 또는 외부 저장장치 사용 등 **외부 장치와의 물리적 연결 정보**를 확인합니다. |
| **EDR 로그** | 비정상적인 **프로세스 실행**을 탐지해 데이터의 임시 저장 및 조작 흔적을 추적합니다. |

-----


## 3\. Hunting 절차 및 탐지 시나리오

#### (1) 1단계: 행위 기반 이상 징후 탐색

**목적:** 업무망에서 평소와 다른 대량의 클립보드 복사 또는 파일 복사 행위를 확인합니다.

```splunk
index=dlp_logs action="clipboard_copy" OR action="file_copy"
| stats count by user, host, _time
| where count > 100
| sort -count
```

> **설명:** 평소 대비 과도하게 많은 클립보드 복사가 발생한 사용자를 식별합니다.

#### (2) 2단계: 외부 전송 흔적 연관 분석

**목적:** 1단계에서 식별된 사용자가 인터넷망에서 외부 파일 업로드 서비스를 이용했는지 확인합니다.

```spl
index=proxy_logs method=POST OR method=PUT
| stats sum(bytes_out) as outbound_bytes by src_ip, dest_domain
| where outbound_bytes > 5000000 AND dest_domain IN ("drive.google.com", "dropbox.com", "*cloud.com", "github.com")
| join type=inner src_ip
    [search index=dlp_logs action="clipboard_copy" | stats count by host]
```

> **설명:** 대량의 데이터를 외부 클라우드 서비스로 전송한 IP를 찾고, 해당 IP가 업무망에서 클립보드 복사 이력이 있는 PC인지 **상관관계를 분석**합니다.

#### (3) 3단계: 시간적 연관성 및 KVM 사용 흔적 확인

**목적:** 두 이벤트가 **동일한 시간대**에 발생했는지 확인하고, 해당 PC의 **KVM 스위치 사용 이력**을 점검합니다.

> **분석:** DLP 로그의 복사 발생 시간과 Proxy 로그의 전송 발생 시간을 비교해 **타임라인**을 일치시킵니다. 이후 EDR/USB 로그를 통해 KVM 스위치 연결 이력을 확인하여 유출 시도를 확정합니다.

-----

## 4\. 분석 결과 및 대응 방안

### **분석 결과**

특정 사용자 **`Kim`** 의 업무망 PC에서 10분 동안 **500회 이상의 클립보드 복사** 이벤트가 발생했습니다. 이후, 동일 사용자의 인터넷망 PC에서 **`Google Drive`** 로 **50MB** 이상의 파일 업로드가 탐지되었습니다. 두 이벤트의 발생 시간은 **1분 이내**로 매우 근접했습니다. 추가 분석 결과, 해당 PC에는 **KVM 스위치**가 연결되어 있었습니다.

**결론:** KVM 스위치를 이용한 **내부 정보 유출 시도**로 판단.

### **대응 방안**

  * **즉각적 조치:** 해당 사용자 계정 및 PC에 대한 네트워크 접근을 차단하고, 포렌식 조사를 진행합니다.
  * **정책적 보완:** KVM 스위치 사용에 대한 **보안 가이드라인을 강화**하고, 필요시 물리망 사용 금지 정책을 검토합니다.
  * **기술적 대응:** DLP 정책에 KVM 스위치를 통한 **클립보드/파일 복사 차단 룰**을 추가하고, Proxy 룰을 강화하여 비인가 클라우드 서비스로의 파일 업로드를 원천 차단합니다.

